<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏°‡∏Å‡∏≤‡∏£ (Auto Difficulty)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;600&display=swap');

        body {
            font-family: 'Kanit', sans-serif;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin-top: 10px; color: #f1c40f; margin-bottom: 5px; }

        .game-container {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        /* --- Score Board & Level --- */
        .status-bar { 
            display: flex;
            justify-content: space-between;
            width: 90%;
            max-width: 500px;
            margin-bottom: 10px;
            color: #ecf0f1; 
            font-size: 18px;
        }
        .status-item span { font-weight: bold; font-size: 22px; color: #f1c40f; }

        .level-badge {
            background: #e67e22;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            animation: bounce 1s infinite alternate;
        }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }

        /* --- Target Box --- */
        .target-box {
            font-size: 50px;
            background: #e74c3c;
            padding: 10px 40px;
            border-radius: 15px;
            display: inline-block;
            margin-bottom: 20px;
            box-shadow: 0 5px 0 #c0392b;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* --- Equation Slots --- */
        .equation-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .slot {
            width: 70px;
            height: 70px;
            background-color: #ecf0f1;
            border: 4px dashed #95a5a6;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 28px;
            color: #2c3e50;
            font-weight: bold;
            transition: all 0.2s;
            cursor: pointer;
        }

        .slot.filled {
            border-style: solid;
            border-color: #2ecc71;
            background-color: #fff;
            box-shadow: 0 4px 0 #bdc3c7;
        }
        .slot.filled:hover { background-color: #ffcccc; border-color: #e74c3c; }

        .equals-sign { font-size: 30px; margin: 0 5px; }

        /* --- Options --- */
        .options-area {
            background: white;
            padding: 15px;
            border-radius: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            min-height: 80px;
        }

        .option-item {
            width: 55px;
            height: 55px;
            background: #3498db;
            color: white;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 #2980b9;
            transition: transform 0.1s;
        }
        .option-item:active { transform: translateY(2px); box-shadow: none; }
        .option-item[data-type="operator"] { background: #9b59b6; box-shadow: 0 4px 0 #8e44ad; }
        .option-item.selected {
            border: 4px solid #f1c40f;
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 10px 0 #f39c12;
            z-index: 10;
        }

        /* --- Buttons --- */
        .btn-check {
            margin-top: 20px;
            padding: 12px 30px;
            font-size: 20px;
            background-color: #27ae60;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 #219150;
            font-family: 'Kanit', sans-serif;
        }
        .btn-check:active { transform: translateY(4px); box-shadow: none; }

        /* --- POPUP STYLES --- */
        .modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(44, 62, 80, 0.95);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            animation: fadeIn 0.3s;
        }

        #correct-modal { background: rgba(39, 174, 96, 0.95); }
        #game-over-modal { background: rgba(44, 62, 80, 0.95); }

        .modal-content { text-align: center; animation: popIn 0.5s; }
        .modal-title { font-size: 40px; margin: 0; font-weight: bold; text-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
        .modal-text { font-size: 24px; margin: 10px 0 30px 0; }

        .btn-modal {
            padding: 15px 30px;
            font-size: 22px;
            background-color: white;
            color: #333;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 0 rgba(0,0,0,0.2);
            font-weight: bold;
        }
        .btn-modal:active { transform: translateY(4px); box-shadow: none; }

        /* Helpers */
        .hidden { visibility: hidden; }
        .correct-bg { background-color: #27ae60 !important; color: white !important; }
        .wrong-bg { animation: shake 0.5s; background-color: #c0392b !important; color: white !important; }

        @keyframes shake {
            0% { transform: translateX(0); } 25% { transform: translateX(-10px); } 
            75% { transform: translateX(10px); } 100% { transform: translateX(0); }
        }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    </style>
</head>
<body>

    <h1>üë®‚Äçüç≥ ‡∏ô‡∏±‡∏Å‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏°‡∏Å‡∏≤‡∏£</h1>
    
    <div class="status-bar">
        <div class="status-item">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="score">0</span></div>
        <div id="level-display" class="level-badge">LEVEL 1</div>
        <div class="status-item">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: <span id="best-score">0</span></div>
    </div>

    <div class="game-container">
        
        <div id="correct-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-title">üéâ ‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! üéâ</div>
                <p class="modal-text">+10 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                <button class="btn-modal" onclick="nextLevel()">‡∏î‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ ‚û°</button>
            </div>
        </div>

        <div id="game-over-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-title" style="color: #e74c3c;">‡∏à‡∏ö‡πÄ‡∏Å‡∏°! üò≠</div>
                <p class="modal-text">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: <span id="final-score">0</span></p>
                <button class="btn-modal" onclick="resetGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà üîÑ</button>
            </div>
        </div>

        <div>‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:</div>
        <div id="target-number" class="target-box">?</div>

        <div class="equation-area">
            <div class="slot" id="slot-1" onclick="handleSlotClick(this)"></div>
            <div class="slot" id="slot-op" onclick="handleSlotClick(this)"></div>
            <div class="slot" id="slot-2" onclick="handleSlotClick(this)"></div>
            <div class="equals-sign">=</div>
            <div id="target-display" style="font-size: 28px; font-weight: bold;">?</div>
        </div>

        <p style="margin: 5px 0 10px 0;">‡∏à‡∏¥‡πâ‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á üëá</p>
        <div class="options-area" id="options-container">
            </div>

        <button class="btn-check" onclick="checkAnswer()">‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö ‚úÖ</button>
    </div>

    <script>
        let currentTarget = 0;
        let score = 0;
        let currentLevel = 1;
        let bestScore = localStorage.getItem('mathGameBestScore') || 0;
        let selectedItem = null; 

        document.getElementById('best-score').innerText = bestScore;

        // --- Logic ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏° (Dynamic Difficulty) ---
        function getDifficultyParams(score) {
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Level ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ó‡∏∏‡∏Å‡πÜ 100 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô = 1 Level)
            const level = Math.floor(score / 100) + 1;
            
            let maxNum = 10;
            let operators = ['+', '-'];
            let maxMultiply = 9; // ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏π‡∏ì‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô)

            if (level === 1) {
                // 0-99: ‡∏á‡πà‡∏≤‡∏¢
                maxNum = 10;
                operators = ['+', '-'];
            } else if (level === 2) {
                // 100-199: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ‡∏Ñ‡∏π‡∏ì, ‡πÄ‡∏•‡∏Ç‡∏ñ‡∏∂‡∏á 20
                maxNum = 20;
                operators = ['+', '-', '*'];
                maxMultiply = 9; // ‡∏Ñ‡∏π‡∏ì‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
            } else if (level === 3) {
                // 200-299: ‡πÄ‡∏•‡∏Ç‡∏ñ‡∏∂‡∏á 50
                maxNum = 50;
                operators = ['+', '-', '*'];
                maxMultiply = 12; // ‡∏Ñ‡∏π‡∏ì‡∏ñ‡∏∂‡∏á‡πÅ‡∏°‡πà 12
            } else {
                // 300+: ‡∏¢‡∏≤‡∏Å‡∏™‡∏∏‡∏î
                maxNum = 100;
                operators = ['+', '-', '*'];
                maxMultiply = 15;
            }

            return { level, maxNum, operators, maxMultiply };
        }

        function generateLevel() {
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const difficulty = getDifficultyParams(score);
            currentLevel = difficulty.level;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ Level
            document.getElementById('level-display').innerText = `LEVEL ${currentLevel}`;

            // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢)
            const selectedOp = difficulty.operators[Math.floor(Math.random() * difficulty.operators.length)];
            
            let num1, num2;

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏π‡∏ì ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡πà‡∏≠‡∏¢ (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏î‡πá‡∏Å‡∏Ñ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏≠‡∏≠‡∏Å)
            if (selectedOp === '*') {
                num1 = Math.floor(Math.random() * difficulty.maxMultiply) + 2; // 2 ‡∏ñ‡∏∂‡∏á maxMultiply
                num2 = Math.floor(Math.random() * difficulty.maxMultiply) + 2;
            } else {
                // ‡∏ñ‡πâ‡∏≤‡∏ö‡∏ß‡∏Å/‡∏•‡∏ö ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏õ‡∏Å‡∏ï‡∏¥
                num1 = Math.floor(Math.random() * difficulty.maxNum) + 1;
                num2 = Math.floor(Math.random() * difficulty.maxNum) + 1;
            }

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            let result;
            if (selectedOp === '+') result = num1 + num2;
            else if (selectedOp === '-') result = num1 - num2;
            else if (selectedOp === '*') result = num1 * num2;

            // ‡∏ñ‡πâ‡∏≤‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô 0 (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡πá‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô) ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏Ç‡πÄ‡∏¢‡∏≠‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏ß‡∏Å (‡πÄ‡∏ä‡πà‡∏ô level 1 ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô 20)
            if (result <= 0 || (currentLevel === 1 && result > 20)) { 
                generateLevel(); 
                return; 
            }

            currentTarget = result;
            document.getElementById('target-number').innerText = currentTarget;
            document.getElementById('target-display').innerText = currentTarget;
            
            clearSlots();
            selectedItem = null;

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Array)
            let options = [];
            options.push({ val: num1, type: 'number' });
            options.push({ val: num2, type: 'number' });
            options.push({ val: selectedOp, type: 'operator' });

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏≠‡∏Å (Decoy) ‡∏ó‡∏µ‡πà‡∏™‡∏°‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏°‡∏ú‡∏•‡∏Å‡∏±‡∏ö Level
            options.push({ val: Math.floor(Math.random() * difficulty.maxNum) + 1, type: 'number' });
            options.push({ val: Math.floor(Math.random() * difficulty.maxNum) + 1, type: 'number' });
            
            // ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏Å (‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏ñ‡∏π‡∏Å)
            const allOps = ['+', '-', '*'];
            const decoyOp = allOps.filter(o => o !== selectedOp)[0];
            options.push({ val: decoyOp, type: 'operator' });

            // ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (Shuffle)
            options.sort(() => Math.random() - 0.5);

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            options.forEach((item, index) => {
                const el = document.createElement('div');
                el.classList.add('option-item');
                el.innerText = item.val;
                el.id = 'opt-' + index;
                el.dataset.val = item.val;
                el.dataset.type = item.type;
                el.onclick = () => handleOptionClick(el);
                container.appendChild(el);
            });
        }

        // --- Interaction Logic (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) ---
        function handleOptionClick(el) {
            if (selectedItem && selectedItem.id === el.id) {
                el.classList.remove('selected');
                selectedItem = null;
                return;
            }
            document.querySelectorAll('.option-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            selectedItem = { id: el.id, val: el.dataset.val, type: el.dataset.type };
        }

        function handleSlotClick(slot) {
            if (selectedItem) {
                let isValid = false;
                if (slot.id === 'slot-op' && selectedItem.type === 'operator') isValid = true;
                if ((slot.id === 'slot-1' || slot.id === 'slot-2') && selectedItem.type === 'number') isValid = true;

                if (isValid) {
                    if (slot.classList.contains('filled')) returnItemToInventory(slot);
                    slot.innerText = selectedItem.val;
                    slot.dataset.value = selectedItem.val;
                    slot.dataset.sourceId = selectedItem.id;
                    slot.classList.add('filled');

                    const sourceEl = document.getElementById(selectedItem.id);
                    sourceEl.classList.add('hidden');
                    sourceEl.classList.remove('selected');
                    selectedItem = null;
                } else {
                    slot.classList.add('wrong-bg');
                    setTimeout(() => slot.classList.remove('wrong-bg'), 300);
                }
            } else if (slot.classList.contains('filled')) {
                returnItemToInventory(slot);
            }
        }

        function returnItemToInventory(slot) {
            const sourceId = slot.dataset.sourceId;
            if (sourceId) {
                const sourceEl = document.getElementById(sourceId);
                if (sourceEl) sourceEl.classList.remove('hidden', 'selected');
            }
            slot.innerText = '';
            slot.classList.remove('filled', 'correct-bg', 'wrong-bg');
            delete slot.dataset.value;
            delete slot.dataset.sourceId;
        }

        function clearSlots() {
            ['slot-1', 'slot-op', 'slot-2'].forEach(id => {
                returnItemToInventory(document.getElementById(id));
            });
        }

        // --- Check Answer & Level Flow ---
        function checkAnswer() {
            const v1 = document.getElementById('slot-1').dataset.value;
            const op = document.getElementById('slot-op').dataset.value;
            const v2 = document.getElementById('slot-2').dataset.value;

            if (!v1 || !op || !v2) {
                alert("‡∏à‡∏¥‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }

            let userResult = 0;
            const num1 = parseInt(v1);
            const num2 = parseInt(v2);

            if (op === '+') userResult = num1 + num2;
            else if (op === '-') userResult = num1 - num2;
            else if (op === '*') userResult = num1 * num2;

            if (userResult === currentTarget) {
                score += 10;
                document.getElementById('score').innerText = score;
                document.querySelectorAll('.slot').forEach(s => s.classList.add('correct-bg'));
                
                setTimeout(() => {
                    document.getElementById('correct-modal').style.display = 'flex';
                }, 300);
            } else {
                triggerGameOver();
            }
        }

        function nextLevel() {
            document.getElementById('correct-modal').style.display = 'none';
            generateLevel();
        }

        function triggerGameOver() {
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('mathGameBestScore', bestScore);
                document.getElementById('best-score').innerText = bestScore;
            }
            document.getElementById('final-score').innerText = score;
            document.getElementById('game-over-modal').style.display = 'flex';
        }

        function resetGame() {
            score = 0;
            document.getElementById('score').innerText = score;
            document.getElementById('game-over-modal').style.display = 'none';
            generateLevel();
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°
        generateLevel();

    </script>
</body>
</html>
